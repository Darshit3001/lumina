// ============================================================
// LUMINA — 3D Habit Sanctuary
// Prisma Schema for Supabase PostgreSQL
// ============================================================

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ── User ────────────────────────────────────────────────────
model User {
  id           String   @id @default(cuid())
  clerkId      String   @unique
  email        String   @unique
  name         String?
  avatarUrl    String?
  subscription String   @default("free") // "free" | "pro" | "enterprise"
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  habits     Habit[]
  entries    HabitEntry[]
  aiMessages AiMessage[]

  @@map("users")
}

// ── Habit ───────────────────────────────────────────────────
model Habit {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  category    String   @default("general") // wellness, fitness, learning, mindfulness, etc.
  color       String   @default("#a855f7")  // hex color for the 3D crystal
  frequency   String   @default("daily")    // daily, weekly, custom
  target      Int      @default(1)          // times per frequency period
  icon        String   @default("sparkles") // lucide icon name
  isArchived  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user    User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  entries HabitEntry[]

  @@index([userId])
  @@map("habits")
}

// ── Habit Entry (completion log) ────────────────────────────
model HabitEntry {
  id        String   @id @default(cuid())
  habitId   String
  userId    String
  date      DateTime @db.Date
  completed Boolean  @default(false)
  value     Int      @default(1) // for quantifiable habits
  note      String?
  createdAt DateTime @default(now())

  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([habitId, date])
  @@index([userId, date])
  @@map("habit_entries")
}

// ── AI Coach Messages ───────────────────────────────────────
model AiMessage {
  id        String   @id @default(cuid())
  userId    String
  role      String   // "user" | "assistant"
  content   String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("ai_messages")
}
